# Mahjong Game (麻将游戏)

这是一个基于Python实现的命令行麻将游戏项目，采用客户端/服务器架构。

## 项目概述

本项目实现了一个支持2-4名玩家通过网络进行游戏的麻将游戏。服务器负责管理游戏逻辑、牌局进程和玩家状态，客户端则连接到服务器，接收游戏信息，并允许玩家进行交互操作。游戏包含了麻将的基本规则，如摸牌、打牌、碰、杠、胡牌和听牌等。

## 主要特性

* **客户端/服务器架构**: 支持多玩家通过网络进行游戏。
* **基本麻将动作**:
    * 摸牌 (Draw)
    * 打牌 (Discard)
    * 碰 (Pong)
    * 杠 (Gang - 包括暗杠、明杠、补杠/加杠)
    * 胡牌 (Hu - 包括自摸和点炮)
    * 听牌 (Ting / Listening)
    * 过 (Pass)
* **游戏状态显示**: 客户端清晰展示手牌、亮出的牌组（副露）、其他玩家的弃牌、牌堆剩余牌数等。
* **中文牌张显示**: 牌张以中文名称（如“一万”，“东风”）显示，方便理解。
* **可配置的游戏规则 (部分)**:
    * 服务器启动时可配置玩家人数 (2-4人)。
    * 服务器启动时可配置是否包含风牌和箭牌。
* **详细的日志记录**: 客户端和服务器均包含日志记录，方便调试和追踪游戏进程。

## 项目文件结构

* `mahjong_server.py`: 服务器端主程序。负责监听客户端连接、管理游戏实例、处理游戏逻辑和玩家间的通信。
* `mahjong_client.py`: 客户端主程序。负责连接服务器、接收和显示游戏状态、发送玩家操作。
* `mahjong_client2.py`: 另一个客户端文件，功能与 `mahjong_client.py` 类似或为其副本/变体。
* `mahjong_game.py`: 包含核心游戏逻辑的模块。定义了 `Game` (游戏主控)、`Player` (玩家状态和操作)、`Deck` (牌堆) 和 `GameRules` (游戏规则配置) 等类。
* `mahjong_common.py`: 包含客户端和服务器共享的通用工具和常量，如牌张定义、排序函数、网络通信辅助函数 (`send_json`, `receive_json`) 等。
* `README.md`: 本文件，项目说明。

## 环境要求与运行指南

### 环境要求

* Python 3.x

### 运行步骤

1.  **启动服务器**:
    打开一个终端窗口，导航到项目根目录，然后运行服务器脚本：
    ```bash
    python mahjong_server.py
    ```
    服务器启动后会提示输入玩家人数和是否包含风牌/箭牌。配置完成后，服务器将开始监听连接，并显示其IP地址和端口号（默认为 `127.0.0.1:12345` 或局域网IP）。

2.  **启动客户端**:
    为每个玩家打开一个新的终端窗口。导航到项目根目录，然后运行客户端脚本：
    ```bash
    python mahjong_client.py
    ```
    客户端启动后会提示输入服务器的IP地址和端口号（如果服务器和客户端在同一台机器上运行，可以直接使用默认的 `127.0.0.1` 和 `12345`）。然后，输入玩家名称。

3.  **开始游戏**:
    当所有配置的玩家都连接到服务器后，游戏将自动开始。按照客户端的提示进行操作。

## 游戏玩法简述

1.  游戏开始后，玩家会收到初始手牌。
2.  轮到当前玩家时，会从牌堆摸一张牌。
3.  玩家可以选择执行“胡牌”、“杠牌”（如果满足条件且未听牌）、“叫听”或“打牌”。
4.  如果玩家打出一张牌：
    * 其他玩家可以对这张弃牌进行响应，如“胡牌”、“杠牌”或“碰牌”。
    * 响应有优先级（通常是 胡 > 杠/碰）。
    * 如果没有玩家响应，或者响应被处理后，轮到下一位玩家摸牌。
5.  游戏直到有玩家胡牌或牌堆摸完（流局）为止。
6.  游戏结束后会显示最终结果。

## 已实现的游戏规则亮点

* **标准胡牌**: 支持基本的 m \* AAA + n \* ABC + DD 的牌型（以及混儿牌情况下的变种，尽管当前服务器配置无混儿）。
* **七对**: 支持七对牌型胡牌。
* **过水不胡逻辑框架**: `Player` 类中有处理过水不胡的状态标记 (`passed_hu_on_discard`, `passed_hu_on_zimo_opportunity`)，但当前服务器配置 (`GameRules`) 中 `enable_passed_hu_rule` 为 `False`，即该规则默认关闭。
* **混儿牌逻辑框架**: `Player` 类和 `GameRules` 类中设计了对混儿牌（Joker）的支持，包括混儿牌做将、组成面子等，但当前服务器配置中 `joker_tile` 为 `None`，即无混儿牌。
* **杠后补牌**: 玩家杠牌后会从牌堆末尾摸一张补牌。
* **听牌**: 玩家可以选择进入听牌状态。听牌后，通常会自动打出摸到的牌（如果不能自摸）。

## (可选) 未来可能的改进

* 实现更复杂的计番规则。
* 增加图形用户界面 (GUI)。
* 完善网络异常处理和重连机制。
* 允许更灵活的游戏规则配置（例如，在服务器启动时通过命令行参数或配置文件进行设置）。
* 增加对更多特殊牌型（如十三幺、国士无双等）的判断。
* 对“过水不胡”和“混儿牌”等规则的支持。
* 实现保存和加载游戏进度的功能。